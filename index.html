<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHSSS Chat</title>
<style>
:root {
    --primary-color: #8774e1;
    --bg-color: #0f0f0f;
    --secondary-bg: #1e1e1e;
    --text-color: #e0e0e0;
    --border-color: #2d2d2d;
    --message-out-bg: #2b5278;
    --message-in-bg: #182533;
    --hover-color: #2a2a2a;
    --shadow: 0 2px 5px rgba(0,0,0,0.3);
    --header-height: 60px;
    --input-height: 60px;
}
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background-color: var(--bg-color); color: var(--text-color); height:100vh; display:flex; flex-direction:column; overflow:hidden; }
.header { height: var(--header-height); display:flex; justify-content:space-between; align-items:center; padding:0 15px; background-color:var(--secondary-bg); border-bottom:1px solid var(--border-color); }
.logo { font-weight:bold; color: var(--primary-color); font-size:1.2rem; }
.header-actions { display:flex; gap:15px; }
.header-button { background:none; border:none; color: var(--text-color); cursor:pointer; font-size:1.2rem; }
.container { display:flex; flex:1; overflow:hidden; }
.sidebar { width:350px; border-right:1px solid var(--border-color); display:flex; flex-direction:column; overflow:hidden; }
.search-container { padding:10px; border-bottom:1px solid var(--border-color); }
.search-input { width:100%; padding:10px 15px; border-radius:18px; border:none; background-color: var(--hover-color); color: var(--text-color); }
.contacts-list { overflow-y:auto; flex:1; }
.contact { display:flex; align-items:center; padding:12px 15px; cursor:pointer; border-bottom:1px solid var(--border-color); }
.contact:hover, .contact.active { background-color: var(--hover-color); }
.contact-avatar { width:45px; height:45px; border-radius:50%; margin-right:12px; background-color: var(--primary-color); display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:18px; }
.contact-info { flex:1; overflow:hidden; }
.contact-name { font-weight:bold; margin-bottom:4px; }
.contact-preview { font-size:0.85rem; color:#a0a0a0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.chat-container { flex:1; display:flex; flex-direction:column; }
.chat-header { height:var(--header-height); padding:0 15px; border-bottom:1px solid var(--border-color); display:flex; align-items:center; background-color: var(--secondary-bg); }
.chat-messages { flex:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; background-color: var(--bg-color); }
.message { max-width:70%; padding:8px 12px; margin-bottom:10px; border-radius:8px; position:relative; }
.message-out { align-self:flex-end; background-color: var(--message-out-bg); }
.message-in { align-self:flex-start; background-color: var(--message-in-bg); }
.message-sender { font-size:0.75rem; font-weight:bold; margin-bottom:4px; color:var(--primary-color); }
.message-time { font-size:0.7rem; color:#a0a0a0; text-align:right; margin-top:4px; }
.chat-input-container { height:var(--input-height); padding:10px 15px; border-top:1px solid var(--border-color); display:flex; align-items:center; background-color: var(--secondary-bg); }
.chat-input { flex:1; padding:12px 15px; border-radius:20px; border:none; background-color: var(--hover-color); color: var(--text-color); }
.send-button { background-color: var(--primary-color); color:white; border:none; border-radius:50%; width:40px; height:40px; margin-left:10px; cursor:pointer; }
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:1000; }
.modal-content { background-color: var(--secondary-bg); padding:20px; border-radius:8px; width:90%; max-width:400px; box-shadow: var(--shadow); }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
.close-button { background:none; border:none; font-size:1.5rem; cursor:pointer; color: var(--text-color); }
.form-group { margin-bottom:15px; }
.form-label { display:block; margin-bottom:5px; font-size:0.9rem; color:#a0a0a0; }
.form-input { width:100%; padding:10px; border-radius:4px; border:1px solid var(--border-color); background-color: var(--hover-color); color: var(--text-color); }
.form-button { width:100%; padding:12px; background-color: var(--primary-color); color:white; border:none; border-radius:4px; cursor:pointer; margin-top:10px; font-weight:bold; }
.secondary-button { background-color: var(--hover-color); color: var(--text-color); }
.hidden { display:none; }
.profile-container { padding:15px; }
.profile-avatar { width:80px; height:80px; border-radius:50%; background-color: var(--primary-color); display:flex; align-items:center; justify-content:center; color:white; font-size:2rem; font-weight:bold; margin:0 auto 15px; }
.admin-section { border-top:1px solid var(--border-color); margin-top:20px; padding-top:20px; }
.admin-panel { padding:15px; overflow-y:auto; max-height:400px; }
.admin-table { width:100%; border-collapse:collapse; margin:10px 0; font-size:0.9rem; }
.admin-table th, .admin-table td { padding:8px; text-align:left; border-bottom:1px solid var(--border-color); }
.admin-button { padding:5px 10px; background-color:#e53935; color:white; border:none; border-radius:4px; cursor:pointer; font-size:0.8rem; }
.tab-container { display:flex; border-bottom:1px solid var(--border-color); margin-bottom:15px; }
.tab { padding:8px 15px; cursor:pointer; font-size:0.9rem; }
.tab.active { border-bottom:2px solid var(--primary-color); }
.tab-content { display:none; }
.tab-content.active { display:block; }
.empty-state { text-align:center; padding:30px; color:#a0a0a0; }
</style>
</head>
<body>

<!-- Auth Modal -->
<div id="authModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2 id="authModalTitle">Login</h2>
<button class="close-button" onclick="hideAuthModal()">&times;</button>
</div>
<div class="tab-container">
<div class="tab active" onclick="switchAuthTab('login')">Login</div>
<div class="tab" onclick="switchAuthTab('signup')">Sign Up</div>
</div>
<div id="loginTab" class="tab-content active">
<div class="form-group">
<label class="form-label" for="loginUsername">Username</label>
<input type="text" id="loginUsername" class="form-input" placeholder="Enter your username">
</div>
<div class="form-group">
<label class="form-label" for="loginPassword">Password</label>
<input type="password" id="loginPassword" class="form-input" placeholder="Enter your password">
</div>
<div id="loginError" style="color:#e53935;margin-bottom:10px;"></div>
<button class="form-button" onclick="login()">Login</button>
</div>
<div id="signupTab" class="tab-content">
<div class="form-group">
<label class="form-label" for="signupUsername">Username</label>
<input type="text" id="signupUsername" class="form-input" placeholder="Choose a username">
</div>
<div class="form-group">
<label class="form-label" for="signupPassword">Password</label>
<input type="password" id="signupPassword" class="form-input" placeholder="Choose a password">
</div>
<div class="form-group">
<label class="form-label" for="signupProfileImage">Profile Image URL (optional)</label>
<input type="text" id="signupProfileImage" class="form-input" placeholder="URL for your profile image">
</div>
<div class="form-group">
<label class="form-label" for="signupAbout">About (optional)</label>
<input type="text" id="signupAbout" class="form-input" placeholder="Tell something about yourself">
</div>
<button class="form-button" onclick="signup()">Sign Up</button>
</div>
</div>
</div>

<!-- Settings / Admin Modal -->
<div id="settingsModal" class="modal hidden">
<div class="modal-content">
<div class="modal-header">
<h2>Settings</h2>
<button class="close-button" onclick="hideSettingsModal()">&times;</button>
</div>
<div class="profile-container">
<div class="profile-avatar" id="settingsAvatar">U</div>
<div class="form-group">
<label class="form-label" for="settingsProfileImage">Profile Image URL</label>
<input type="text" id="settingsProfileImage" class="form-input">
</div>
<div class="form-group">
<label class="form-label" for="settingsAbout">About</label>
<input type="text" id="settingsAbout" class="form-input">
</div>
<button class="form-button" onclick="updateProfile()">Update Profile</button>

<div id="adminSection" class="admin-section hidden">
<h3>Admin Panel</h3>
<div class="tab-container">
<div class="tab active" onclick="switchAdminTab('users')">Users</div>
<div class="tab" onclick="switchAdminTab('messages')">All Messages</div>
<div class="tab" onclick="switchAdminTab('ban')">Ban/Unban IP</div>
</div>

<div id="adminUsersTab" class="tab-content active">
<table class="admin-table">
<thead><tr><th>Username</th><th>IP</th><th>Action</th></tr></thead>
<tbody id="adminUsersList"></tbody>
</table>
</div>

<div id="adminMessagesTab" class="tab-content"><div id="adminMessagesList" class="admin-panel"></div></div>

<div id="adminBanTab" class="tab-content">
<div class="form-group">
<label class="form-label" for="banIP">IP Address</label>
<input type="text" id="banIP" class="form-input" placeholder="Enter IP to ban/unban">
</div>
<div class="form-group">
<label class="form-label" for="banReason">Reason (optional)</label>
<input type="text" id="banReason" class="form-input" placeholder="Reason for ban">
</div>
<div class="form-buttons" style="display:flex; gap:10px;">
<button class="form-button" onclick="banIP()">Ban IP</button>
<button class="form-button secondary-button" onclick="unbanIP()">Unban IP</button>
</div>
</div>

</div>
</div>
</div>

<!-- Main Interface -->
<div class="header">
<div class="logo">SHSSS Chat</div>
<div class="header-actions">
<button class="header-button" onclick="showSettingsModal()">⚙️</button>
</div>
</div>

<div class="container">
<div class="sidebar">
<div class="search-container">
<input type="text" class="search-input" placeholder="Search contacts">
</div>
<div class="contacts-list" id="contactsList">
<div class="empty-state">No contacts yet.</div>
</div>
</div>
<div class="chat-container">
<div class="chat-header" id="chatHeader">Select a contact</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input-container">
<input type="text" class="chat-input" id="chatInput" placeholder="Type a message">
<button class="send-button" onclick="sendMessage()">➤</button>
</div>
</div>
</div>

<script>
// --- Auth Modal ---
function showAuthModal(){document.getElementById('authModal').classList.remove('hidden');}
function hideAuthModal(){document.getElementById('authModal').classList.add('hidden');}
function switchAuthTab(tab){document.querySelectorAll('#authModal .tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('#authModal .tab-content').forEach(c=>c.classList.remove('active'));document.querySelector('#authModal .tab[onclick*="'+tab+'"]').classList.add('active');document.getElementById(tab+'Tab').classList.add('active');}
function showSettingsModal(){document.getElementById('settingsModal').classList.remove('hidden');}
function hideSettingsModal(){document.getElementById('settingsModal').classList.add('hidden');}
function switchAdminTab(tab){document.querySelectorAll('#adminSection .tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('#adminSection .tab-content').forEach(c=>c.classList.remove('active'));document.querySelector('#adminSection .tab[onclick*="'+tab+'"]').classList.add('active');document.getElementById('admin'+tab.charAt(0).toUpperCase()+tab.slice(1)+'Tab').classList.add('active');}

// --- Placeholder JS for login/signup ---
function login(){
    const user=document.getElementById('loginUsername').value;
    const pass=document.getElementById('loginPassword').value;
    if(!user||!pass){document.getElementById('loginError').innerText="Enter username and password";return;}
    fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:user,password:pass})})
    .then(r=>r.json()).then(res=>{
        if(res.success){hideAuthModal();alert('Logged in!');}
        else{document.getElementById('loginError').innerText=res.reason||'Login failed';}
    });
}
function signup(){alert('Sign up placeholder');}
function updateProfile(){alert('Update profile placeholder');}
function sendMessage(){alert('Send message placeholder');}

// --- Admin Ban/Unban ---
function banIP(){const ip=document.getElementById('banIP').value;const reason=document.getElementById('banReason').value;fetch('/api/admin/ban_ip',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({ip,reason})}).then(r=>r.json()).then(res=>alert(res.message||'IP banned')); }
function unbanIP(){const ip=document.getElementById('banIP').value;fetch('/api/admin/unban_ip',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({ip})}).then(r=>r.json()).then(res=>alert(res.message||'IP unbanned')); }

</script>
</body>
</html>
